<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="robots" content="noindex">

	<title>File activate.php | Object Sync for Salesforce</title>

	<link rel="stylesheet" href="resources/style.css?c2f33731c1948fbed7c333554678bfa68d4817da">

</head>

<body>
<div id="left">
	<div id="menu">
		<a href="index.html" title="Overview"><span>Overview</span></a>


		<div id="groups">
		</div>



		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li><a href="class-Object_Sync_Salesforce.html">Object_Sync_Salesforce</a></li>
				<li><a href="class-Object_Sync_Sf_Activate.html">Object_Sync_Sf_Activate</a></li>
				<li><a href="class-Object_Sync_Sf_Admin.html">Object_Sync_Sf_Admin</a></li>
				<li><a href="class-Object_Sync_Sf_Admin_Notice.html">Object_Sync_Sf_Admin_Notice</a></li>
				<li><a href="class-Object_Sync_Sf_Deactivate.html">Object_Sync_Sf_Deactivate</a></li>
				<li><a href="class-Object_Sync_Sf_Logging.html">Object_Sync_Sf_Logging</a></li>
				<li><a href="class-Object_Sync_Sf_Mapping.html">Object_Sync_Sf_Mapping</a></li>
				<li><a href="class-Object_Sync_Sf_Salesforce.html">Object_Sync_Sf_Salesforce</a></li>
				<li><a href="class-Object_Sync_Sf_Salesforce_Pull.html">Object_Sync_Sf_Salesforce_Pull</a></li>
				<li><a href="class-Object_Sync_Sf_Salesforce_Push.html">Object_Sync_Sf_Salesforce_Push</a></li>
				<li><a href="class-Object_Sync_Sf_Salesforce_Select_Query.html">Object_Sync_Sf_Salesforce_Select_Query</a></li>
				<li><a href="class-Object_Sync_Sf_Salesforce_Soap_Partner.html">Object_Sync_Sf_Salesforce_Soap_Partner</a></li>
				<li><a href="class-Object_Sync_Sf_Schedule.html">Object_Sync_Sf_Schedule</a></li>
				<li><a href="class-Object_Sync_Sf_WordPress.html">Object_Sync_Sf_WordPress</a></li>
				<li><a href="class-Object_Sync_Sf_WordPress_Transient.html">Object_Sync_Sf_WordPress_Transient</a></li>
			</ul>



			<h3>Exceptions</h3>
			<ul>
				<li><a href="class-Object_Sync_Sf_Exception.html">Object_Sync_Sf_Exception</a></li>
				<li><a href="class-WordpressException.html">WordpressException</a></li>
			</ul>


		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
<div id="rightInner">
	<form id="search">
		<input type="hidden" name="cx" value="">
		<input type="hidden" name="ie" value="UTF-8">
		<input type="text" name="q" class="text" placeholder="Search">
	</form>

	<div id="navigation">
		<ul>
			<li>
				<a href="index.html" title="Overview"><span>Overview</span></a>
			</li>
			<li>
<span>Class</span>			</li>
		</ul>
		<ul>
				<li>
					<a href="annotation-group-todo.html" title="List of elements with todo annotation">
						<span>Todo</span>
					</a>
				</li>
		</ul>
		<ul>
		</ul>
	</div>

<pre class="numbers"><code><span class="l"><a href="#1">  1: </a></span><span class="l"><a href="#2">  2: </a></span></span><span class="l"><a href="#3">  3: </a></span></span><span class="l"><a href="#4">  4: </a></span></span><span class="l"><a href="#5">  5: </a></span></span><span class="l"><a href="#6">  6: </a></span><span class="l"><a href="#7">  7: </a></span><span class="l"><a href="#8">  8: </a></span><span class="l"><a href="#9">  9: </a></span><span class="l"><a href="#10"> 10: </a></span><span class="l"><a href="#11"> 11: </a></span><span class="l"><a href="#12"> 12: </a></span></span><span class="l"><a href="#13"> 13: </a></span></span><span class="l"><a href="#14"> 14: </a></span><span class="l"><a href="#15"> 15: </a></span><span class="l"><a href="#16"> 16: </a></span><span class="l"><a href="#17"> 17: </a></span><span class="l"><a href="#18"> 18: </a></span><span class="l"><a href="#19"> 19: </a></span><span class="l"><a href="#20"> 20: </a></span><span class="l"><a href="#21"> 21: </a></span></span><span class="l"><a href="#22"> 22: </a></span></span><span class="l"><a href="#23"> 23: </a></span></span><span class="l"><a href="#24"> 24: </a></span></span><span class="l"><a href="#25"> 25: </a></span></span><span class="l"><a href="#26"> 26: </a></span></span><span class="l"><a href="#27"> 27: </a></span></span><span class="l"><a href="#28"> 28: </a></span><span class="l"><a href="#29"> 29: </a></span><span class="l"><a href="#30"> 30: </a></span><span class="l"><a href="#31"> 31: </a></span><span class="l"><a href="#32"> 32: </a></span><span class="l"><a href="#33"> 33: </a></span><span class="l"><a href="#34"> 34: </a></span><span class="l"><a href="#35"> 35: </a></span><span class="l"><a href="#36"> 36: </a></span><span class="l"><a href="#37"> 37: </a></span><span class="l"><a href="#38"> 38: </a></span><span class="l"><a href="#39"> 39: </a></span></span><span class="l"><a href="#40"> 40: </a></span></span><span class="l"><a href="#41"> 41: </a></span><span class="l"><a href="#42"> 42: </a></span><span class="l"><a href="#43"> 43: </a></span><span class="l"><a href="#44"> 44: </a></span><span class="l"><a href="#45"> 45: </a></span><span class="l"><a href="#46"> 46: </a></span><span class="l"><a href="#47"> 47: </a></span><span class="l"><a href="#48"> 48: </a></span><span class="l"><a href="#49"> 49: </a></span></span><span class="l"><a href="#50"> 50: </a></span></span><span class="l"><a href="#51"> 51: </a></span></span><span class="l"><a href="#52"> 52: </a></span></span><span class="l"><a href="#53"> 53: </a></span><span class="l"><a href="#54"> 54: </a></span><span class="l"><a href="#55"> 55: </a></span><span class="l"><a href="#56"> 56: </a></span><span class="l"><a href="#57"> 57: </a></span><span class="l"><a href="#58"> 58: </a></span><span class="l"><a href="#59"> 59: </a></span></span><span class="l"><a href="#60"> 60: </a></span></span><span class="l"><a href="#61"> 61: </a></span></span><span class="l"><a href="#62"> 62: </a></span></span><span class="l"><a href="#63"> 63: </a></span></span><span class="l"><a href="#64"> 64: </a></span></span><span class="l"><a href="#65"> 65: </a></span></span><span class="l"><a href="#66"> 66: </a></span></span><span class="l"><a href="#67"> 67: </a></span></span><span class="l"><a href="#68"> 68: </a></span></span><span class="l"><a href="#69"> 69: </a></span></span><span class="l"><a href="#70"> 70: </a></span></span><span class="l"><a href="#71"> 71: </a></span></span><span class="l"><a href="#72"> 72: </a></span></span><span class="l"><a href="#73"> 73: </a></span></span><span class="l"><a href="#74"> 74: </a></span></span><span class="l"><a href="#75"> 75: </a></span></span><span class="l"><a href="#76"> 76: </a></span></span><span class="l"><a href="#77"> 77: </a></span><span class="l"><a href="#78"> 78: </a></span><span class="l"><a href="#79"> 79: </a></span><span class="l"><a href="#80"> 80: </a></span></span><span class="l"><a href="#81"> 81: </a></span></span><span class="l"><a href="#82"> 82: </a></span></span><span class="l"><a href="#83"> 83: </a></span></span><span class="l"><a href="#84"> 84: </a></span></span><span class="l"><a href="#85"> 85: </a></span></span><span class="l"><a href="#86"> 86: </a></span></span><span class="l"><a href="#87"> 87: </a></span></span><span class="l"><a href="#88"> 88: </a></span></span><span class="l"><a href="#89"> 89: </a></span></span><span class="l"><a href="#90"> 90: </a></span></span><span class="l"><a href="#91"> 91: </a></span></span><span class="l"><a href="#92"> 92: </a></span></span><span class="l"><a href="#93"> 93: </a></span></span><span class="l"><a href="#94"> 94: </a></span></span><span class="l"><a href="#95"> 95: </a></span></span><span class="l"><a href="#96"> 96: </a></span><span class="l"><a href="#97"> 97: </a></span><span class="l"><a href="#98"> 98: </a></span><span class="l"><a href="#99"> 99: </a></span><span class="l"><a href="#100">100: </a></span><span class="l"><a href="#101">101: </a></span><span class="l"><a href="#102">102: </a></span><span class="l"><a href="#103">103: </a></span><span class="l"><a href="#104">104: </a></span><span class="l"><a href="#105">105: </a></span><span class="l"><a href="#106">106: </a></span><span class="l"><a href="#107">107: </a></span><span class="l"><a href="#108">108: </a></span><span class="l"><a href="#109">109: </a></span><span class="l"><a href="#110">110: </a></span><span class="l"><a href="#111">111: </a></span><span class="l"><a href="#112">112: </a></span><span class="l"><a href="#113">113: </a></span></span><span class="l"><a href="#114">114: </a></span></span><span class="l"><a href="#115">115: </a></span></span><span class="l"><a href="#116">116: </a></span></span><span class="l"><a href="#117">117: </a></span><span class="l"><a href="#118">118: </a></span><span class="l"><a href="#119">119: </a></span><span class="l"><a href="#120">120: </a></span><span class="l"><a href="#121">121: </a></span><span class="l"><a href="#122">122: </a></span><span class="l"><a href="#123">123: </a></span><span class="l"><a href="#124">124: </a></span></span><span class="l"><a href="#125">125: </a></span></span><span class="l"><a href="#126">126: </a></span></span><span class="l"><a href="#127">127: </a></span></span><span class="l"><a href="#128">128: </a></span></span><span class="l"><a href="#129">129: </a></span></span><span class="l"><a href="#130">130: </a></span><span class="l"><a href="#131">131: </a></span><span class="l"><a href="#132">132: </a></span><span class="l"><a href="#133">133: </a></span><span class="l"><a href="#134">134: </a></span><span class="l"><a href="#135">135: </a></span><span class="l"><a href="#136">136: </a></span><span class="l"><a href="#137">137: </a></span><span class="l"><a href="#138">138: </a></span><span class="l"><a href="#139">139: </a></span><span class="l"><a href="#140">140: </a></span><span class="l"><a href="#141">141: </a></span><span class="l"><a href="#142">142: </a></span><span class="l"><a href="#143">143: </a></span><span class="l"><a href="#144">144: </a></span><span class="l"><a href="#145">145: </a></span><span class="l"><a href="#146">146: </a></span><span class="l"><a href="#147">147: </a></span><span class="l"><a href="#148">148: </a></span><span class="l"><a href="#149">149: </a></span><span class="l"><a href="#150">150: </a></span><span class="l"><a href="#151">151: </a></span></code></pre>
<pre class="code"><code><span id="1" class="l"><span class="xlang">&lt;?php</span>
</span><span id="2" class="l"><span class="php-comment">/**
</span></span><span id="3" class="l"><span class="php-comment"> * Class file for the Object_Sync_Sf_Activate class.
</span></span><span id="4" class="l"><span class="php-comment"> *
</span></span><span id="5" class="l"><span class="php-comment"> * @file
</span></span><span id="6" class="l"><span class="php-comment"> */</span>
</span><span id="7" class="l">
</span><span id="8" class="l"><span class="php-keyword1">if</span> ( ! <span class="php-keyword2">class_exists</span>( <span class="php-quote">'Object_Sync_Salesforce'</span> ) ) {
</span><span id="9" class="l">    <span class="php-keyword1">die</span>();
</span><span id="10" class="l">}
</span><span id="11" class="l">
</span><span id="12" class="l"><span class="php-comment">/**
</span></span><span id="13" class="l"><span class="php-comment"> * What to do when the plugin is activated
</span></span><span id="14" class="l"><span class="php-comment"> */</span>
</span><span id="15" class="l"><span class="php-keyword1">class</span> Object_Sync_Sf_Activate {
</span><span id="16" class="l">
</span><span id="17" class="l">    <span class="php-keyword1">protected</span> <span class="php-var">$wpdb</span>;
</span><span id="18" class="l">    <span class="php-keyword1">protected</span> <span class="php-var">$version</span>;
</span><span id="19" class="l">    <span class="php-keyword1">protected</span> <span class="php-var">$installed_version</span>;
</span><span id="20" class="l">
</span><span id="21" class="l">    <span class="php-comment">/**
</span></span><span id="22" class="l"><span class="php-comment">    * Constructor which sets up activate hooks
</span></span><span id="23" class="l"><span class="php-comment">    *
</span></span><span id="24" class="l"><span class="php-comment">    * @param object $wpdb
</span></span><span id="25" class="l"><span class="php-comment">    * @param string $version
</span></span><span id="26" class="l"><span class="php-comment">    * @param string $slug
</span></span><span id="27" class="l"><span class="php-comment">    *
</span></span><span id="28" class="l"><span class="php-comment">    */</span>
</span><span id="29" class="l">    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> __construct( <span class="php-var">$wpdb</span>, <span class="php-var">$version</span>, <span class="php-var">$slug</span> ) {
</span><span id="30" class="l">        <span class="php-var">$this</span>-&gt;wpdb              = <span class="php-var">$wpdb</span>;
</span><span id="31" class="l">        <span class="php-var">$this</span>-&gt;version           = <span class="php-var">$version</span>;
</span><span id="32" class="l">        <span class="php-var">$this</span>-&gt;installed_version = get_option( <span class="php-quote">'object_sync_for_salesforce_db_version'</span>, <span class="php-quote">''</span> );
</span><span id="33" class="l">        register_activation_hook( <span class="php-keyword2">dirname</span>( __DIR__ ) . <span class="php-quote">'/'</span> . <span class="php-var">$slug</span> . <span class="php-quote">'.php'</span>, <span class="php-keyword1">array</span>( <span class="php-var">$this</span>, <span class="php-quote">'php_requirements'</span> ) );
</span><span id="34" class="l">        register_activation_hook( <span class="php-keyword2">dirname</span>( __DIR__ ) . <span class="php-quote">'/'</span> . <span class="php-var">$slug</span> . <span class="php-quote">'.php'</span>, <span class="php-keyword1">array</span>( <span class="php-var">$this</span>, <span class="php-quote">'wordpress_salesforce_tables'</span> ) );
</span><span id="35" class="l">        register_activation_hook( <span class="php-keyword2">dirname</span>( __DIR__ ) . <span class="php-quote">'/'</span> . <span class="php-var">$slug</span> . <span class="php-quote">'.php'</span>, <span class="php-keyword1">array</span>( <span class="php-var">$this</span>, <span class="php-quote">'add_roles_capabilities'</span> ) );
</span><span id="36" class="l">        add_action( <span class="php-quote">'plugins_loaded'</span>, <span class="php-keyword1">array</span>( <span class="php-var">$this</span>, <span class="php-quote">'wordpress_salesforce_update_db_check'</span> ) );
</span><span id="37" class="l">    }
</span><span id="38" class="l">
</span><span id="39" class="l">    <span class="php-comment">/**
</span></span><span id="40" class="l"><span class="php-comment">    * Check for the minimum required version of php
</span></span><span id="41" class="l"><span class="php-comment">    */</span>
</span><span id="42" class="l">    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> php_requirements() {
</span><span id="43" class="l">        <span class="php-keyword1">if</span> ( <span class="php-keyword2">version_compare</span>( PHP_VERSION, <span class="php-quote">'5.5'</span>, <span class="php-quote">'&lt;'</span> ) ) {
</span><span id="44" class="l">            deactivate_plugins( plugin_basename( __FILE__ ) );
</span><span id="45" class="l">            wp_die( <span class="php-quote">'&lt;strong&gt;This plugin requires PHP Version 5.5&lt;/strong&gt; &lt;br /&gt;Please contact your host to upgrade PHP on your server, and then retry activating the plugin.'</span> );
</span><span id="46" class="l">        }
</span><span id="47" class="l">    }
</span><span id="48" class="l">
</span><span id="49" class="l">    <span class="php-comment">/**
</span></span><span id="50" class="l"><span class="php-comment">    * Create database tables for Salesforce
</span></span><span id="51" class="l"><span class="php-comment">    * This creates tables for fieldmaps (between types of objects) and object maps (between indidual instances of objects)
</span></span><span id="52" class="l"><span class="php-comment">    *
</span></span><span id="53" class="l"><span class="php-comment">    */</span>
</span><span id="54" class="l">    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> wordpress_salesforce_tables() {
</span><span id="55" class="l">
</span><span id="56" class="l">        <span class="php-var">$charset_collate</span> = <span class="php-var">$this</span>-&gt;wpdb-&gt;get_charset_collate();
</span><span id="57" class="l">
</span><span id="58" class="l">        <span class="php-var">$field_map_table</span> = <span class="php-var">$this</span>-&gt;wpdb-&gt;prefix . <span class="php-quote">'object_sync_sf_field_map'</span>;
</span><span id="59" class="l">        <span class="php-var">$field_map_sql</span>   = <span class="php-quote">&quot;CREATE TABLE </span><span class="php-var">$field_map_table</span><span class="php-quote"> (
</span></span><span id="60" class="l"><span class="php-quote">            id bigint(20) unsigned NOT NULL AUTO_INCREMENT,
</span></span><span id="61" class="l"><span class="php-quote">            label varchar(64) NOT NULL DEFAULT '',
</span></span><span id="62" class="l"><span class="php-quote">            name varchar(64) NOT NULL DEFAULT '',
</span></span><span id="63" class="l"><span class="php-quote">            wordpress_object varchar(128) NOT NULL DEFAULT '',
</span></span><span id="64" class="l"><span class="php-quote">            salesforce_object varchar(255) NOT NULL DEFAULT '',
</span></span><span id="65" class="l"><span class="php-quote">            salesforce_record_types_allowed longblob,
</span></span><span id="66" class="l"><span class="php-quote">            salesforce_record_type_default varchar(255) NOT NULL DEFAULT '',
</span></span><span id="67" class="l"><span class="php-quote">            fields longtext NOT NULL,
</span></span><span id="68" class="l"><span class="php-quote">            pull_trigger_field varchar(128) NOT NULL DEFAULT 'LastModifiedDate',
</span></span><span id="69" class="l"><span class="php-quote">            sync_triggers text NOT NULL,
</span></span><span id="70" class="l"><span class="php-quote">            push_async tinyint(1) NOT NULL DEFAULT '0',
</span></span><span id="71" class="l"><span class="php-quote">            push_drafts tinyint(1) NOT NULL DEFAULT '0',
</span></span><span id="72" class="l"><span class="php-quote">            weight tinyint(1) NOT NULL DEFAULT '0',
</span></span><span id="73" class="l"><span class="php-quote">            version varchar(255) NOT NULL DEFAULT '',
</span></span><span id="74" class="l"><span class="php-quote">            PRIMARY KEY  (id),
</span></span><span id="75" class="l"><span class="php-quote">            UNIQUE KEY name (name),
</span></span><span id="76" class="l"><span class="php-quote">            KEY name_sf_type_wordpress_type (wordpress_object,salesforce_object)
</span></span><span id="77" class="l"><span class="php-quote">        ) ENGINE=InnoDB </span><span class="php-var">$charset_collate</span><span class="php-quote">&quot;</span>;
</span><span id="78" class="l">
</span><span id="79" class="l">        <span class="php-var">$object_map_table</span> = <span class="php-var">$this</span>-&gt;wpdb-&gt;prefix . <span class="php-quote">'object_sync_sf_object_map'</span>;
</span><span id="80" class="l">        <span class="php-var">$object_map_sql</span>   = <span class="php-quote">&quot;CREATE TABLE </span><span class="php-var">$object_map_table</span><span class="php-quote"> (
</span></span><span id="81" class="l"><span class="php-quote">            id bigint(20) unsigned NOT NULL AUTO_INCREMENT,
</span></span><span id="82" class="l"><span class="php-quote">            wordpress_id varchar(32) NOT NULL,
</span></span><span id="83" class="l"><span class="php-quote">            salesforce_id varbinary(32) NOT NULL DEFAULT '',
</span></span><span id="84" class="l"><span class="php-quote">            wordpress_object varchar(128) NOT NULL DEFAULT '',
</span></span><span id="85" class="l"><span class="php-quote">            created datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
</span></span><span id="86" class="l"><span class="php-quote">            object_updated datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
</span></span><span id="87" class="l"><span class="php-quote">            last_sync datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
</span></span><span id="88" class="l"><span class="php-quote">            last_sync_action varchar(128) DEFAULT NULL,
</span></span><span id="89" class="l"><span class="php-quote">            last_sync_status tinyint(1) NOT NULL DEFAULT '0',
</span></span><span id="90" class="l"><span class="php-quote">            last_sync_message varchar(255) DEFAULT NULL,
</span></span><span id="91" class="l"><span class="php-quote">            PRIMARY KEY  (id),
</span></span><span id="92" class="l"><span class="php-quote">            UNIQUE KEY salesforce (salesforce_id),
</span></span><span id="93" class="l"><span class="php-quote">            UNIQUE KEY salesforce_wordpress (wordpress_object,wordpress_id),
</span></span><span id="94" class="l"><span class="php-quote">            KEY wordpress_object (wordpress_object,wordpress_id),
</span></span><span id="95" class="l"><span class="php-quote">            KEY salesforce_object (salesforce_id)
</span></span><span id="96" class="l"><span class="php-quote">        ) </span><span class="php-var">$charset_collate</span><span class="php-quote">&quot;</span>;
</span><span id="97" class="l">
</span><span id="98" class="l">        <span class="php-keyword1">require_once</span>( ABSPATH . <span class="php-quote">'wp-admin/includes/upgrade.php'</span> );
</span><span id="99" class="l">
</span><span id="100" class="l">        <span class="php-comment">// Note: see https://wordpress.stackexchange.com/questions/67345/how-to-implement-wordpress-plugin-update-that-modifies-the-database</span>
</span><span id="101" class="l">        <span class="php-comment">// When we run the dbDelta method below, &quot;it checks if the table exists. What's more, it checks the column types. So if the table doesn't exist, it creates it, if it does, but some column types have changed it updates them, and if a column doesn't exists - it adds it.&quot;</span>
</span><span id="102" class="l">        <span class="php-comment">// This does not remove columns if we remove columns, so we'll need to expand beyond this in the future if that happens, although I think the schema is pretty solid now.</span>
</span><span id="103" class="l">        dbDelta( <span class="php-var">$field_map_sql</span> );
</span><span id="104" class="l">        dbDelta( <span class="php-var">$object_map_sql</span> );
</span><span id="105" class="l">
</span><span id="106" class="l">        update_option( <span class="php-quote">'object_sync_for_salesforce_db_version'</span>, <span class="php-var">$this</span>-&gt;version );
</span><span id="107" class="l">
</span><span id="108" class="l">        <span class="php-comment">// store right now as the time for the plugin's activation</span>
</span><span id="109" class="l">        update_option( <span class="php-quote">'object_sync_for_salesforce_activate_time'</span>, current_time( <span class="php-quote">'timestamp'</span>, <span class="php-keyword1">true</span> ) );
</span><span id="110" class="l">
</span><span id="111" class="l">    }
</span><span id="112" class="l">
</span><span id="113" class="l">    <span class="php-comment">/**
</span></span><span id="114" class="l"><span class="php-comment">    * Check for database version on plugin upgrade
</span></span><span id="115" class="l"><span class="php-comment">    * When the plugin is upgraded, if the database version does not match the current version, perform these methods
</span></span><span id="116" class="l"><span class="php-comment">    *
</span></span><span id="117" class="l"><span class="php-comment">    */</span>
</span><span id="118" class="l">    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> wordpress_salesforce_update_db_check() {
</span><span id="119" class="l">        <span class="php-keyword1">if</span> ( get_site_option( <span class="php-quote">'object_sync_for_salesforce_db_version'</span> ) !== <span class="php-var">$this</span>-&gt;version ) {
</span><span id="120" class="l">            <span class="php-var">$this</span>-&gt;wordpress_salesforce_tables();
</span><span id="121" class="l">        }
</span><span id="122" class="l">    }
</span><span id="123" class="l">
</span><span id="124" class="l">    <span class="php-comment">/**
</span></span><span id="125" class="l"><span class="php-comment">    * Add roles and capabilities
</span></span><span id="126" class="l"><span class="php-comment">    * This adds the configure_salesforce capability to the admin role
</span></span><span id="127" class="l"><span class="php-comment">    *
</span></span><span id="128" class="l"><span class="php-comment">    * It also allows other plugins to add the capability to other roles
</span></span><span id="129" class="l"><span class="php-comment">    *
</span></span><span id="130" class="l"><span class="php-comment">    */</span>
</span><span id="131" class="l">    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> add_roles_capabilities() {
</span><span id="132" class="l">
</span><span id="133" class="l">        <span class="php-comment">// by default, only administrators can configure the plugin</span>
</span><span id="134" class="l">        <span class="php-var">$role</span> = get_role( <span class="php-quote">'administrator'</span> );
</span><span id="135" class="l">        <span class="php-var">$role</span>-&gt;add_cap( <span class="php-quote">'configure_salesforce'</span> );
</span><span id="136" class="l">
</span><span id="137" class="l">        <span class="php-comment">// hook that allows other roles to configure the plugin as well</span>
</span><span id="138" class="l">        <span class="php-var">$roles</span> = apply_filters( <span class="php-quote">'object_sync_for_salesforce_roles_configure_salesforce'</span>, <span class="php-keyword1">null</span> );
</span><span id="139" class="l">
</span><span id="140" class="l">        <span class="php-comment">// for each role that we have, give it the configure salesforce capability</span>
</span><span id="141" class="l">        <span class="php-keyword1">if</span> ( <span class="php-keyword1">null</span> !== <span class="php-var">$roles</span> ) {
</span><span id="142" class="l">            <span class="php-keyword1">foreach</span> ( <span class="php-var">$roles</span> <span class="php-keyword1">as</span> <span class="php-var">$role</span> ) {
</span><span id="143" class="l">                <span class="php-var">$role</span> = get_role( <span class="php-var">$role</span> );
</span><span id="144" class="l">                <span class="php-var">$role</span>-&gt;add_cap( <span class="php-quote">'configure_salesforce'</span> );
</span><span id="145" class="l">            }
</span><span id="146" class="l">        }
</span><span id="147" class="l">
</span><span id="148" class="l">    }
</span><span id="149" class="l">
</span><span id="150" class="l">}
</span><span id="151" class="l"></span></code></pre>

	<div id="footer">
		Object Sync for Salesforce API documentation generated by <a href="http://apigen.org">ApiGen</a>
	</div>
</div>
</div>
<script src="resources/combined.js?accf70cfac0fe15b4c80f6039ece408b240e9042"></script>
<script src="elementlist.js?04aa35b40ab3986ede0da77d700f9b59bb72cde5"></script>
</body>
</html>
