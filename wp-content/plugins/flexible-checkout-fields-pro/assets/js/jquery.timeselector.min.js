(function(b){var a=function(){this._$div=null;this._inst=null;this._showing=false;this.uuid=new Date().getTime();this.initialized=false};a.prototype={constructor:a,_generateHtml:function(){return'<div id="timeselector-div" class="timeselector"><div class="timeselector-item timeselector-hour" data-type="hour"><a class="timeselector-button timeselector-up">+</a><span class="timeselector-value"></span><a class="timeselector-button timeselector-down">-</a></div><div class="timeselector-separator">:</div><div class="timeselector-item timeselector-minute" data-type="minute"><a class="timeselector-button timeselector-up">+</a><span class="timeselector-value"></span><a class="timeselector-button timeselector-down">-</a></div></div>'},_setTime:function(e,d){var c=e.date;if(d){c.setTime(+c+(1000*60*d))}e.input.val(this._format(c,e.options.hours12));e.lastValue=e.input.val()},_setTimeFromField:function(f){if(f.input.val()===f.lastValue){return}f.lastValue=f.input.val();var d=new Date(),e,c;e=this._match(f.lastValue);if(e){c=parseInt(e[0],10);if(e[2]){if(e[2].toLowerCase()==="am"&&c===12){c=0}else{if(e[2].toLowerCase()==="pm"&&c>0&&c<12){c=c+12}}}d.setHours(c);d.setMinutes(parseInt(e[1],10))}f.date=d},_match:function(d){var e=/^((?:1[012]|0[1-9])|(?:[01][0-9]|2[0-3])):([0-5][0-9])(?:\s(am|pm))?$/i,c=e.exec(d);if(c){c.splice(0,1)}return c},_update:function(c){var d=this._format(c.date,c.options.hours12);d=this._match(d);this._$div.find(".timeselector-value").each(function(e){b(this).text(d[e])})},_format:function(e,c){var d=e.getHours(),g=e.getMinutes(),f=function(h){return(h<10?"0":"")+h};if(c){if(d===0){d=12}else{if(d>12){d=d-12}}return f(d)+":"+f(g)+" "+(e.getHours()<12?"AM":"PM")}return f(d)+":"+f(g)},_getInst:function(c){return b(c).data("timeselector")},_selectTime:function(g,e,c,d){d=d||500;var f=this;clearTimeout(this._timer);this._timer=setTimeout(function(){f._selectTime(g,e,c,50)},d);this._setTime(g,e==="hour"?c*60:c*g.options.step);this._update(g)},_stop:function(){clearTimeout(this._timer)},_doKeyDown:function(c){var d=this._getInst(c.target);switch(c.which){case 27:this._hide();break;case 38:this._selectTime(d,"minute",1);break;case 40:this._selectTime(d,"minute",-1);break;case 33:this._selectTime(d,"hour",1);break;case 34:this._selectTime(d,"hour",-1);break}},_doKeyUp:function(c){var d=this._getInst(c.target);if(d.input.val()!==d.lastValue&&this._showing){this._setTimeFromField(d);this._update(d)}this._stop()},_show:function(c){c=c.target||c;if(this._lastInput===c){return}var g=b(c),d=this._getInst(c),e=false,f;if(this._inst&&this._inst!==d){this._inst.div.stop(true,true)}this._lastInput=c;this._setTimeFromField(d);this._update(d);g.parents().each(function(){e=b(this).css("position")==="fixed";return !e});f=g.offset();f.top+=c.offsetHeight;f.left-=e?b(document).scrollLeft():0;f.top-=e?b(document).scrollTop():0;d.div.css({position:(e?"fixed":"absolute"),display:"none",top:f.top,left:f.left,zIndex:this._zIndex(c)+1});d.div.fadeIn("fast");this._showing=true;this._inst=d},_hide:function(){var c=this._inst;if(!c||!this._showing){return}c.div.fadeOut("fast");this._lastInput=null;this._showing=false},_checkExternalClick:function(d){if(!this._inst){return}var c=b(d.target),e=this._getInst(c[0]);if((!e&&!c.closest("#timeselector-div").length&&this._showing)||(e&&this._inst!==e)){this._hide()}},_zIndex:function(d){d=b(d);var c,e;while(d.length&&d[0]!==document){c=d.css("position");if(c==="absolute"||c==="relative"||c==="fixed"){e=parseInt(d.css("zIndex"),10);if(!isNaN(e)&&e!==0){return e}}d=d.parent()}return 0},_attach:function(e,c){var d;if(this._getInst(e)){return}if(!e.id){this.uuid+=1;e.id="timeselector-input-"+this.uuid}d={id:e.id,input:b(e),div:this._$div,options:b.extend({},c)};this._setTimeFromField(d);if(this._match(e.value)){this._setTime(d)}b(e).data("timeselector",d).attr("autocomplete","off").on("keydown.timeselector",b.proxy(this._doKeyDown,this)).on("keyup.timeselector",b.proxy(this._doKeyUp,this)).on("focus.timeselector",b.proxy(this._show,this)).on("blur.timeselector",b.proxy(this._stop,this))},_create:function(){var c=this;this._$div=b(this._generateHtml()).appendTo("body").hide().on("mousedown.timeselector",".timeselector-button",function(d){var e=b(this);if(c._inst.input[0]!==document.activeElement){c._inst.input.focus()}e.addClass("timeselector-state-active");c._selectTime(c._inst,e.parent(".timeselector-item").data("type"),e.hasClass("timeselector-up")?1:-1);d.preventDefault()}).on("mouseup.timeselector",".timeselector-button",function(){b(this).removeClass("timeselector-state-active");c._stop()}).on("mouseenter.timeselector",".timeselector-button",function(){var d=b(this);if(d.hasClass("timeselector-state-active")){c._selectTime(c._inst,d.parent(".timeselector-item").data("type"),d.hasClass("timeselector-up")?1:-1)}}).on("mouseleave.timeselector",".timeselector-button",b.proxy(this._stop,this)).on("click.timeselector",".timeselector-value",function(){c._setTime(c._inst);c._hide()});b(document).on("mousedown.timeselector",b.proxy(this._checkExternalClick,this))},option:function(e,c){var d=this._getInst(e);if(d){if(this._inst===d){this._hide()}b.extend(d.options,c);this._setTime(d);this._update(d)}},refresh:function(d){var c=this._getInst(d);if(c){this._setTimeFromField(c);this._update(c);if(this._match(d.value)){this._setTime(c)}}}};b.fn.timeselector=function(d){var c=Array.prototype.slice.call(arguments,1);if(!b.fn.timeselector.timer.initialized){b.fn.timeselector.timer._create();b.fn.timeselector.timer.initialized=true}if(typeof d==="string"){this.each(function(){var e=b.fn.timeselector.timer[d];if(typeof e==="function"&&d.charAt(0)!=="_"){e.apply(b.fn.timeselector.timer,[this].concat(c))}})}else{d=b.extend({},b.fn.timeselector.defaults,d);this.each(function(){b.fn.timeselector.timer._attach(this,d)})}return this};b.fn.timeselector.defaults={hours12:true,step:1};b.fn.timeselector.timer=new a()}(jQuery));